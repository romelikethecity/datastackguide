---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import ToolCard from '../../components/ToolCard.astro';

import categoriesData from '../../../data/categories.json';
import marketData from '../../../data/market_signals.json';

export function getStaticPaths() {
  return categoriesData.categories.map((cat: any) => ({
    params: { slug: cat.slug },
    props: { category: cat }
  }));
}

interface Props {
  category: any;
}

const { category } = Astro.props;
const totalJobs = marketData.total_jobs_analyzed;

// Related categories (exclude current)
const relatedCategories = categoriesData.categories
  .filter((c: any) => c.slug !== category.slug)
  .slice(0, 4);

const description = `Compare ${category.tool_count}+ ${category.name.toLowerCase()} tools with real pricing, reviews, and job demand data from ${totalJobs.toLocaleString()}+ postings.`;

const schema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": `${category.name} Tools`,
  "numberOfItems": category.tool_count,
  "itemListElement": category.tools.slice(0, 20).map((tool: any, i: number) => ({
    "@type": "ListItem",
    "position": i + 1,
    "name": tool.name,
    "url": `https://datastackguide.com/tools/${tool.slug}/`
  }))
};
---

<BaseLayout
  title={`${category.name} Tools`}
  description={description}
  canonicalPath={`categories/${category.slug}/`}
  schema={schema}
>
  <div class="container">
    <Breadcrumbs items={[
      { label: 'Home', href: '/' },
      { label: 'Categories', href: '/categories/' },
      { label: category.name }
    ]} />

    <section class="page-hero">
      <div class="category-header">
        <span class="category-icon" style={`background: ${category.color}15; color: ${category.color};`}>
          {category.icon}
        </span>
        <div>
          <h1>{category.name} Tools</h1>
          <p>{category.description}</p>
        </div>
      </div>
      <div class="category-stats">
        <span class="badge">{category.tool_count} tools</span>
        <span class="text-sm text-muted">Data from {totalJobs.toLocaleString()}+ job postings</span>
      </div>
    </section>

    <!-- Tool Grid -->
    <section class="tools-section">
      <h2>All {category.name} Tools</h2>

      {category.tools.length > 0 ? (
        <div class="tool-grid">
          {category.tools.map((tool: any) => (
            <ToolCard
              name={tool.name}
              slug={tool.slug}
              category={category.name}
              categorySlug={category.slug}
              categoryColor={category.color}
              jobCount={tool.job_count}
              description={tool.description}
            />
          ))}
        </div>
      ) : (
        <p class="text-secondary">Tools coming soon. Check back for updates.</p>
      )}
    </section>

    <!-- CTA Block -->
    {(category.slug === 'enrichment' || category.slug === 'cleaning' || category.slug === 'validation' || category.slug === 'list-building') && (
      <section class="cta-section">
        <div class="cta-box">
          <h3>Don't have time to manage this yourself?</h3>
          <p>Verum handles data cleaning and enrichment as a service. Projects start at $500, delivered in 24-48 hours.</p>
          <a href="https://veruminc.com" class="btn" target="_blank" rel="noopener">Learn about Verum →</a>
        </div>
      </section>
    )}

    {category.slug === 'healthcare' && (
      <section class="cta-section">
        <div class="cta-box">
          <h3>Need healthcare-specific data?</h3>
          <p>Provyx provides NPI-verified provider data across 40+ specialties. Pay-per-record, no contracts.</p>
          <a href="https://getprovyx.com" class="btn" target="_blank" rel="noopener">Learn about Provyx →</a>
        </div>
      </section>
    )}

    <!-- Related Categories -->
    <section class="related-section">
      <h2>Related Categories</h2>
      <div class="related-grid">
        {relatedCategories.map((cat: any) => (
          <a href={`/categories/${cat.slug}/`} class="related-card card">
            <span class="related-icon" style={`color: ${cat.color};`}>{cat.icon}</span>
            <div>
              <h3>{cat.name}</h3>
              <span class="text-sm text-muted">{cat.tool_count} tools</span>
            </div>
          </a>
        ))}
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .page-hero {
    padding: var(--space-8) 0 var(--space-6);
  }

  .category-header {
    display: flex;
    align-items: flex-start;
    gap: var(--space-5);
    margin-bottom: var(--space-4);
  }

  .category-icon {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-lg);
    font-size: 1.6rem;
    flex-shrink: 0;
  }

  .category-header h1 {
    margin-bottom: var(--space-2);
  }

  .category-header p {
    color: var(--color-text-secondary);
    line-height: 1.6;
    max-width: 640px;
  }

  .category-stats {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin-top: var(--space-2);
  }

  .tools-section {
    padding: var(--space-8) 0;
  }

  .tools-section h2 {
    margin-bottom: var(--space-6);
  }

  .tool-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-6);
  }

  .cta-section {
    padding: var(--space-8) 0;
  }

  .cta-box {
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-left: 4px solid var(--color-primary);
    border-radius: var(--radius-md);
    padding: var(--space-8);
  }

  .cta-box h3 {
    margin-bottom: var(--space-2);
  }

  .cta-box p {
    color: var(--color-text-secondary);
    margin-bottom: var(--space-5);
  }

  .related-section {
    padding: var(--space-8) 0 var(--space-16);
  }

  .related-section h2 {
    margin-bottom: var(--space-6);
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: var(--space-4);
  }

  .related-card {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-5);
    text-decoration: none;
    color: var(--color-text);
  }

  .related-card h3 {
    font-size: var(--text-base);
    margin-bottom: 0;
  }

  .related-icon {
    font-size: 1.4rem;
  }
</style>
